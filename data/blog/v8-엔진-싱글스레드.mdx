---
title: V8 엔진과 싱글 스레드
date: '2024-03-14'
tags: [V8, 싱글스레드]
draft: false
summary: 'V8 엔진, 그리고 싱글 스레드'
---

# V8 엔진과 싱글 스레드

#

V8 엔진과 자바스크립트의 싱글 스레드 특성은 밀접하게 연결되어 있으며, 이를 이해하기 위해 자바스크립트의 동작 방식과 웹 환경에서의 비동기 처리 메커니즘을 파악하는 것이 중요합니다.

### **1. V8 엔진의 개요**

V8 엔진은 구글이 개발한 오픈 소스 자바스크립트 엔진으로, 자바스크립트 코드를 빠르고 효율적으로 실행하기 위해 설계되었습니다. V8은 구글 크롬과 Node.js에서 사용되고 있으며, Just-In-Time(JIT) 컴파일을 통해 자바스크립트 코드를 기계어로 변환하여 실행 속도를 크게 향상시킵니다.

V8은 특히 웹 애플리케이션의 성능 최적화를 위한 강력한 도구로 자리잡고 있으며, JIT 컴파일, 가비지 컬렉션, 히든 클래스 최적화 등의 기능을 제공합니다.

### **2. 주요 기능 및 작동 원리**

### **1) Just-In-Time (JIT) 컴파일**

JIT 컴파일은 자바스크립트 코드를 한 줄씩 해석하여 실행하는 인터프리터 방식과 달리, 코드 전체를 분석하고 최적화하여 기계어로 변환합니다. 이로 인해 코드가 반복적으로 실행될 때 속도가 크게 향상됩니다.

```jsx
function addNumbers(a, b) {
  return a + b
}
console.log(addNumbers(10, 20))
```

위 함수 `addNumbers`가 여러 번 호출될 때, V8 엔진은 이 코드를 분석하여 최적화된 기계어로 변환해 성능을 최적화합니다.

### **2) 가비지 컬렉션**

V8 엔진은 메모리 관리에도 큰 역할을 합니다. 자바스크립트는 동적으로 메모리를 할당하지만, 개발자가 직접 메모리를 해제하지 않아도 되도록 가비지 컬렉터가 동작하여 사용하지 않는 메모리를 자동으로 해제해줍니다. 이를 통해 메모리 누수를 방지하고 프로그램의 안정성을 유지합니다.

### **3) 히든 클래스와 최적화된 객체 관리**

자바스크립트 객체는 동적으로 속성을 추가하고 삭제할 수 있습니다. 하지만 이러한 특성 때문에 성능 저하가 발생할 수 있습니다. V8 엔진은 객체의 구조를 히든 클래스로 정의하여 속성 관리에 최적화를 제공함으로써 성능 저하를 방지합니다. 히든 클래스는 객체에 새로운 속성이 추가되더라도, 미리 정의된 구조를 기반으로 빠르게 접근할 수 있도록 돕습니다.

### **4) 최적화된 실행 엔진**

V8은 복잡한 최적화를 위해 Ignition과 TurboFan이라는 두 가지 엔진을 사용합니다. Ignition은 자바스크립트 코드를 바이트코드로 컴파일하고, TurboFan은 더 높은 수준에서 코드를 최적화하여 실행 성능을 극대화합니다.

### **3. 웹의 싱글 스레드 특성**

웹 브라우저에서 자바스크립트는 싱글 스레드로 동작합니다. 이는 자바스크립트가 한 번에 하나의 작업만 처리할 수 있다는 의미입니다. 자바스크립트 엔진은 순차적으로 코드를 실행하지만, 다양한 작업을 동시에 처리하는 것처럼 보이게 만드는 비동기 메커니즘이 존재합니다.

### **싱글 스레드인 이유**

웹 환경에서 자바스크립트는 UI와 상호작용하는 언어로 설계되었습니다. 여러 스레드가 동시에 자바스크립트와 UI를 처리하면 충돌이 발생할 수 있습니다. 예를 들어, UI가 업데이트되는 동시에 자바스크립트가 실행되면 데이터 동기화 문제나 충돌이 발생할 수 있습니다. 싱글 스레드 모델은 이러한 충돌을 방지하고 개발자가 보다 쉽게 코드를 작성할 수 있도록 돕습니다.

### **싱글 스레드에서 발생할 수 있는 문제점**

싱글 스레드 환경에서 시간이 많이 소요되는 작업이 실행되면, UI가 멈추거나 전체 페이지가 반응하지 않을 수 있습니다. 예를 들어, 복잡한 계산 작업이 계속 진행되면 사용자는 브라우저가 멈춘 것처럼 느낄 수 있습니다. 이 문제를 해결하기 위해 비동기 처리 기법이 도입되었습니다.

### **4. 비동기 처리와 이벤트 루프**

싱글 스레드 환경에서 자바스크립트가 여러 작업을 동시에 처리하는 것처럼 보이는 이유는 **이벤트 루프(Event Loop)** 덕분입니다.

### **이벤트 루프의 동작 방식**

- **콜스택(Call Stack)**: 자바스크립트 코드 실행을 담당하는 스택입니다. 함수가 호출되면 콜스택에 쌓이고, 실행이 끝나면 콜스택에서 제거됩니다.
- **백그라운드 작업**: 타이머, 네트워크 요청, 파일 입출력 등은 브라우저나 Node.js에서 제공하는 별도의 스레드에서 처리됩니다.
- **콜백 큐(Callback Queue)**: 백그라운드에서 완료된 작업은 콜백 큐에 저장되며, 콜스택이 비워지면 이벤트 루프가 콜백 큐에서 작업을 가져와 실행합니다.

### **비동기 처리 예시**

```jsx
console.log('Start')

setTimeout(() => {
  console.log('Timer done')
}, 2000)

console.log('End')
```

이 코드는 `Start`, `End`, `Timer done` 순으로 출력됩니다. `setTimeout` 함수는 비동기 작업이므로, 설정된 2초가 지난 후에 이벤트 루프가 `Timer done` 메시지를 콜백 큐에서 실행합니다.

### **이벤트 루프의 시각적 설명**

이벤트 루프와 콜스택, 콜백 큐 간의 관계를 다이어그램으로 설명하면 더욱 이해하기 쉽습니다. 콜스택이 비워질 때 콜백 큐에서 작업이 실행되는 과정을 그림으로 표현하면 이벤트 루프의 동작 원리를 명확하게 전달할 수 있습니다.

### **5. V8 엔진과 이벤트 루프의 상호작용**

V8 엔진은 자바스크립트 코드를 실행하고, 이벤트 루프는 비동기 작업을 관리합니다. 이 둘이 함께 작동함으로써 자바스크립트는 싱글 스레드 환경에서도 멀티태스킹처럼 보이는 동작을 할 수 있습니다.

### **6. 실제 적용 사례**

### **1) 구글 크롬**

구글 크롬은 V8 엔진을 사용해 웹 페이지 로딩 속도를 극대화합니다. 빠른 자바스크립트 실행은 사용자 경험을 향상시키며, 페이지 렌더링 속도를 높입니다.

### **2) Node.js**

서버 사이드 자바스크립트에서도 V8 엔진이 사용됩니다. Node.js는 비동기 I/O를 통해 네트워크 요청을 효율적으로 처리할 수 있으며, V8 엔진의 성능 덕분에 많은 요청을 동시에 처리할 수 있는 고성능 서버 애플리케이션을 개발할 수 있습니다.

### **3) 성능 최적화**

비동기 코드 작성 시, 가독성과 유지보수성을 높이기 위해 `async/await` 문법을 사용하면 콜백 지옥을 피할 수 있습니다. 비동기 작업을 명확하고 직관적으로 관리할 수 있으므로 코드 유지보수에 큰 도움이 됩니다.
