---
title: HTTP/3 - 성능과 보안에서의 진화
date: '2024-09-12'
tags: [HTTP]
draft: false
summary: 'HTTP'
---

# JWT 기반 인증: 개념과 보안 취약점

토큰 기반 인증 방식에 대해 설명해주세요. 그리고 JWT 토큰을 쿠키에 저장했을 때 취약점에 대해 설명해주세요.

​

질문의도 입니다!

​

JWT에 대한 기본적인 이해와 함께, JWT를 쿠키에 저장할 때 발생할 수 있는 보안 취약점에 대한 인식을 평가하려는 목적입니다. 이를 통해 인증 및 보안 메커니즘에 대한 깊이 있는 지식과 보안 문제에 대한 인지 능력을 확인하려는 목적이 있습니다.

---

### 토큰 기반 인증 방식

토큰 기반 인증은 서버가 클라이언트를 인증할 때, 세션을 유지하는 대신 **토큰**을 발급하여 클라이언트가 이후 요청을 할 때마다 이를 사용해 인증하는 방식입니다. 가장 널리 사용되는 방식 중 하나가 **JWT (JSON Web Token)**입니다.

### JWT (JSON Web Token)

JWT는 JSON 포맷으로 이루어진 **서명된 토큰**으로, 클라이언트가 서버로부터 인증을 받으면 JWT를 발급받아 클라이언트에 저장하고, 이후 요청 시 이 토큰을 함께 보내 인증을 수행합니다. JWT는 크게 세 부분으로 나누어집니다:

1. **Header**: 토큰의 타입과 서명 알고리즘 정보가 포함됩니다.
2. **Payload**: 인증된 사용자 정보와 권한 등의 데이터를 담습니다.
3. **Signature**: 비밀 키를 기반으로 한 서명으로, 토큰의 무결성을 보장합니다.

서버는 JWT를 디코딩하고 서명을 확인해 해당 요청이 인증된 사용자인지 판단합니다.

### Access Token과 Refresh Token

- **Access Token**: 유효기간이 짧고 주로 클라이언트가 인증된 상태에서 보호된 리소스에 접근할 때 사용됩니다.
- **Refresh Token**: 유효기간이 더 길며, Access Token이 만료되었을 때 새로운 Access Token을 발급받기 위한 용도로 사용됩니다.

### JWT 토큰을 쿠키에 저장했을 때의 보안 취약점

JWT를 클라이언트 측에 저장할 때, 흔히 **쿠키**나 **로컬 스토리지**에 저장합니다. 이 중 JWT를 **쿠키에 저장**하는 경우, 몇 가지 중요한 보안 취약점을 고려해야 합니다.

1. **XSS (Cross-Site Scripting) 공격**:
   쿠키는 **JavaScript**에서 접근할 수 있으므로, 만약 애플리케이션이 XSS 공격에 취약하다면, 악성 스크립트가 쿠키에 접근해 JWT를 탈취할 수 있습니다. 이를 방지하려면, **HttpOnly** 속성을 사용해 JavaScript에서 접근할 수 없도록 설정하는 것이 중요합니다.
2. **CSRF (Cross-Site Request Forgery) 공격**:
   JWT가 쿠키에 저장된 경우, **자동으로 브라우저가 요청 시 쿠키를 포함**하므로, CSRF 공격의 위험이 있습니다. 공격자가 악의적인 사이트를 통해 피해자의 인증 정보를 악용해 서버에 요청을 보낼 수 있습니다. 이를 방지하려면 **CSRF 토큰**을 사용하거나 **SameSite** 속성을 설정해 교차 사이트 요청을 제한하는 방법을 사용할 수 있습니다.
3. **토큰 유효 기간 관리 문제**:
   Refresh Token은 보통 긴 유효기간을 가지므로, 자주 갱신되지 않으면 더 큰 보안 위협이 될 수 있습니다. 특히 쿠키에 Refresh Token을 저장할 경우, 만료 전까지 이 토큰이 유출되면 악의적인 사용자가 장기간 시스템에 접근할 수 있게 됩니다. **유효 기간 관리**와 함께 주기적으로 Refresh Token을 갱신하는 것이 중요합니다.

### 보안 개선 방법

1. **HttpOnly**와 **Secure** 속성을 사용해 쿠키의 보안성을 높이고, XSS 공격을 방지합니다.
2. **CSRF 토큰**을 활용해 CSRF 공격을 방지합니다.
3. Refresh Token은 **주기적인 재발급** 및 보안적인 검증 절차를 강화하는 것이 필요합니다.
4. 필요 시 **토큰 블랙리스트**를 활용하여 만료되거나 유효하지 않은 토큰을 서버에서 관리하는 방식도 고려할 수 있습니다.

이런 요소들을 통해 JWT를 쿠키에 안전하게 저장하고 사용하는 보안 문제를 해결할 수 있습니다.

---

웹 애플리케이션에서 사용자 인증은 중요한 요소 중 하나입니다. 기존의 세션 기반 인증 방식에서 벗어나, 현대의 웹 애플리케이션들은 주로 **토큰 기반 인증**을 사용하고 있습니다. 그 중 가장 널리 사용되는 방식 중 하나가 바로 **JWT(JSON Web Token)** 기반 인증입니다. 이 글에서는 JWT의 기본 개념과 함께, 쿠키에 JWT를 저장했을 때 발생할 수 있는 보안 취약점 및 그 해결책에 대해 알아보겠습니다.

## JWT 기반 인증의 기본 개념

JWT는 JSON 포맷으로 이루어진 서명된 토큰으로, 클라이언트가 서버에서 인증을 받은 후 클라이언트 측에 저장됩니다. 이후 클라이언트는 요청할 때마다 JWT를 함께 보내 인증을 수행합니다. 서버는 해당 JWT를 검증하여 유효성을 확인하고 요청을 처리합니다.

### JWT의 구조

JWT는 **Header**, **Payload**, **Signature**로 나뉩니다.

1. **Header**: 토큰의 타입(JWT)과 서명에 사용할 해싱 알고리즘(HS256 등)을 포함합니다.
2. **Payload**: 사용자 정보(아이디, 권한 등)를 포함하며, 주로 Base64 인코딩된 형태로 저장됩니다.
3. **Signature**: 비밀 키를 사용하여 서명된 부분으로, 토큰의 무결성을 확인하는 역할을 합니다.

서버는 클라이언트가 보낸 JWT의 서명을 검증함으로써, 토큰이 위조되지 않았는지 확인할 수 있습니다.

### Access Token과 Refresh Token

JWT 기반 인증에서는 주로 두 가지 토큰이 사용됩니다.

- **Access Token**: 짧은 유효 기간을 가지며, 보호된 리소스에 접근할 때 사용됩니다.
- **Refresh Token**: 더 긴 유효 기간을 가지며, Access Token이 만료되었을 때 새로운 Access Token을 발급받는 데 사용됩니다.

## JWT 토큰을 쿠키에 저장할 때의 보안 취약점

JWT를 클라이언트 측에 저장할 때, 보통 **로컬 스토리지** 또는 **쿠키**에 저장하는 방법을 선택할 수 있습니다. 이 중, JWT를 **쿠키에 저장**하는 경우에는 몇 가지 중요한 보안 취약점이 발생할 수 있습니다.

### 1. XSS (Cross-Site Scripting) 공격

JWT가 쿠키에 저장되어 있을 때, 웹 애플리케이션이 XSS 공격에 취약하다면, 악성 스크립트가 쿠키에 접근해 JWT를 탈취할 수 있습니다. 이렇게 탈취된 JWT는 공격자가 인증된 사용자로 위장하여 시스템에 접근할 수 있게 됩니다.

### 해결책:

- **HttpOnly** 속성을 사용하여 쿠키에 저장된 JWT에 자바스크립트로 접근하지 못하도록 설정합니다. 이 속성을 설정하면 클라이언트 측 스크립트는 쿠키에 접근할 수 없게 되어 XSS 공격으로부터 보호할 수 있습니다.

### 2. CSRF (Cross-Site Request Forgery) 공격

쿠키는 기본적으로 브라우저가 자동으로 서버로 전송하기 때문에, 악의적인 사이트에서 인증된 사용자의 쿠키를 이용하여 서버에 요청을 보내는 **CSRF 공격**이 발생할 수 있습니다. 즉, 사용자가 악성 웹사이트에 접속할 경우, 해당 웹사이트가 사용자의 쿠키를 이용해 서버에 허가되지 않은 요청을 보낼 수 있습니다.

### 해결책:

- **CSRF 토큰**을 사용하여 요청을 검증하거나, **SameSite** 속성을 설정하여 교차 사이트 간 쿠키 전송을 제한합니다.

### 3. Refresh Token의 유출 위험

Refresh Token은 유효기간이 길기 때문에, 한 번 유출되면 공격자는 장시간 시스템에 접근할 수 있습니다. 특히 쿠키에 저장된 Refresh Token이 유출될 경우, 새로운 Access Token을 지속적으로 발급받을 수 있어 더욱 큰 보안 위협이 됩니다.

### 해결책:

- Refresh Token은 **주기적으로 갱신**하는 방식으로 관리하고, 민감한 정보에 대한 요청 시 추가적인 인증 절차를 거치도록 구현할 수 있습니다.
- Refresh Token의 보안성을 위해 필요한 경우 **블랙리스트** 방식을 도입해, 유효하지 않거나 만료된 토큰을 관리할 수 있습니다.

## JWT를 안전하게 저장하고 사용하는 방법

JWT를 사용하면서 보안을 강화하기 위해서는 몇 가지 중요한 고려 사항이 있습니다.

1. **HttpOnly, Secure 속성 설정**: 쿠키를 저장할 때 **HttpOnly**와 **Secure** 속성을 설정하여, 클라이언트 측에서 쿠키를 조작할 수 없도록 하고, HTTPS를 통해서만 쿠키가 전송되도록 보장합니다.
2. **토큰 유효 기간 관리**: Access Token의 유효 기간은 짧게, Refresh Token은 일정 주기로 재발급하는 방식으로 보안성을 강화할 수 있습니다.
3. **CSRF 방지**: CSRF 공격을 방지하기 위해 **CSRF 토큰**을 사용하고, 쿠키에 **SameSite 속성**을 설정하여 교차 사이트 요청을 방지합니다.

## 마무리

JWT는 세션 관리 없이 인증을 처리할 수 있는 강력한 방법이지만, 클라이언트 측에 저장하는 방식이므로 보안 취약점에 특히 주의해야 합니다. **XSS**와 **CSRF** 같은 공격으로부터 보호하기 위해 적절한 방어 조치를 취하고, 토큰의 유효 기간과 관리 정책을 신중히 설계하는 것이 중요합니다.
