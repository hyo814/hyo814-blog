# 브라우저 렌더링 엔진의 작동 과정과 리플로우 및 리페인트 최적화

9월 3일 프론트엔드 문제입니다!

​

브라우저 렌더링 엔진의 작동 과정을 설명하고, 렌더링 최적화를 위해 사용할 수 있는 기술적 방법들에 대해 논의해 주세요. 특히, 리플로우(reflow)와 리페인트(repaint)의 차이와 이를 최소화하는 방법에 대해 설명해 주세요.

​

질문의도 입니다!

​

브라우저 내부에서 HTML, CSS, JavaScript가 어떻게 처리되어 화면에 렌더링되는지에 대한 깊은 이해를 확인하려는 의도입니다. 브라우저가 DOM과 CSSOM을 생성하고, 이를 결합해 렌더 트리를 생성하며, 레이아웃을 계산하고 페인팅을 수행하는 과정을 이해하고 있어야 합니다.

---

### 모범 답안

### 브라우저 렌더링 엔진의 작동 과정

브라우저는 웹 페이지를 화면에 렌더링하기 위해 여러 단계를 거칩니다.

1. **파싱**: 브라우저는 HTML, CSS, 그리고 JavaScript 파일을 다운로드합니다. 이때 HTML은 DOM(Document Object Model) 트리로, CSS는 CSSOM(CSS Object Model) 트리로 변환됩니다.
2. **DOM과 CSSOM 결합**: 브라우저는 DOM과 CSSOM을 결합하여 **렌더 트리**를 생성합니다. 렌더 트리는 화면에 표시할 요소들만 포함하며, `display: none` 같은 요소는 제외됩니다.
3. **레이아웃 계산**: 렌더 트리가 생성되면, 브라우저는 각 요소의 크기와 위치를 계산합니다. 이 과정을 **레이아웃**이라고 합니다.
4. **페인팅**: 요소들의 위치와 크기가 정해지면, 화면에 실제로 픽셀을 그리는 **페인팅** 작업이 수행됩니다.
5. **컴포지팅(Composite Layers)**: 요소들이 여러 레이어로 나뉘어져 화면에 출력됩니다. 이 레이어들은 GPU를 활용하여 빠르게 합쳐지고, 사용자의 화면에 표시됩니다.

### 리플로우(Reflow)와 리페인트(Repaint)의 차이

1. **리플로우(Reflow)**: DOM 또는 CSSOM의 변화로 인해 페이지의 레이아웃을 다시 계산하는 과정입니다. 예를 들어, 요소의 크기, 위치, 혹은 화면의 전체적인 레이아웃이 변경되면 브라우저는 해당 부분을 다시 계산해야 하며, 이는 성능에 큰 영향을 미칩니다.
2. **리페인트(Repaint)**: 레이아웃은 변경되지 않지만 요소의 스타일(색상, 배경 등)이 변경되어 브라우저가 해당 요소를 다시 그리는 과정입니다. 리플로우에 비해 상대적으로 적은 성능 영향을 미치지만, 자주 발생하면 성능 저하를 일으킬 수 있습니다.

### 리플로우와 리페인트 최소화 방법

1. **CSS 속성 변경 최소화**: 레이아웃에 영향을 미치는 속성(`width`, `height`, `margin` 등)을 자주 변경하면 리플로우가 발생하므로 이를 최소화해야 합니다.
2. **클래스 변경으로 스타일 적용**: 개별 요소의 스타일을 직접 변경하기보다, CSS 클래스를 한 번에 변경하여 리페인트를 최소화할 수 있습니다.
3. **애니메이션 최적화**: `transform`, `opacity`와 같은 속성으로 애니메이션을 구현하면 레이아웃이 변경되지 않으므로 리플로우가 발생하지 않습니다. 또한 GPU 가속을 활용하여 성능을 개선할 수 있습니다.
4. **배치 업데이트 최적화**: 레이아웃을 다시 계산해야 하는 작업은 가능한 한 한 번에 처리해야 합니다. 예를 들어, 요소의 여러 속성을 순차적으로 변경하는 대신, `requestAnimationFrame`과 같은 방법으로 한 번에 업데이트할 수 있습니다.
5. **`will-change` 속성 사용**: 자주 변화할 가능성이 있는 CSS 속성에 대해 미리 브라우저에 힌트를 제공하여 성능 최적화를 할 수 있습니다. 예를 들어, `will-change: transform;`을 사용하면 해당 요소에 대한 리플로우와 리페인트를 줄일 수 있습니다.

---

브라우저는 웹 페이지를 화면에 그릴 때 다양한 작업을 거칩니다. 이 글에서는 브라우저의 렌더링 엔진이 어떻게 동작하는지, 그리고 웹 성능을 최적화하기 위해 중요한 리플로우와 리페인트의 차이점과 이를 최소화하는 방법에 대해 알아보겠습니다.

### 1. 브라우저 렌더링 과정

브라우저는 HTML 파일을 읽고 이를 DOM으로, CSS 파일을 읽어 CSSOM으로 변환합니다. 이 두 트리가 결합되어 렌더 트리가 만들어지고, 요소의 레이아웃이 계산되며, 최종적으로 화면에 그려집니다. 이 과정은 웹 페이지가 어떻게 보일지 결정하는 중요한 단계입니다.

### 2. 리플로우와 리페인트란?

웹 페이지에서 발생하는 다양한 변화는 브라우저가 페이지를 다시 그리도록 합니다. 이때 리플로우와 리페인트라는 두 가지 과정이 발생할 수 있습니다.

- **리플로우**는 요소의 크기나 위치가 변경되었을 때 발생하며, 레이아웃을 다시 계산해야 하는 비용이 큽니다.
- **리페인트**는 요소의 스타일이 변경될 때 발생하며, 레이아웃은 그대로이지만 브라우저가 해당 요소를 다시 그려야 합니다.

리플로우는 리페인트보다 성능에 더 큰 영향을 미치므로, 이를 최소화하는 것이 웹 성능 최적화의 핵심입니다.

### 3. 리플로우와 리페인트를 최소화하는 방법

1. **CSS 속성 변경을 줄이자**: 레이아웃에 영향을 미치는 속성(`width`, `height`, `padding` 등)을 자주 변경하지 말고, 한 번에 필요한 변경만 수행합니다.
2. **클래스를 사용해 스타일 적용**: 개별 요소의 스타일 속성을 자주 변경하는 대신, CSS 클래스를 변경하여 스타일을 적용하면 성능에 긍정적인 영향을 미칩니다.
3. **애니메이션 속성 최적화**: `transform`과 `opacity` 속성은 레이아웃 변경 없이 애니메이션을 구현할 수 있어, GPU 가속을 통해 성능을 크게 개선할 수 있습니다.
4. **배치 작업 최적화**: 레이아웃을 변경해야 하는 작업이 여러 개 있다면, 이를 하나의 작업으로 묶어 처리하는 것이 중요합니다. `requestAnimationFrame` 같은 방법을 사용하면 브라우저가 작업을 효율적으로 처리하도록 도울 수 있습니다.
5. **`will-change` 속성 사용**: 특정 요소가 자주 변경될 예정이라면, `will-change` 속성을 사용해 브라우저에 미리 힌트를 주는 것이 좋습니다.

리플로우와 리페인트를 최소화하는 것은 웹 성능 최적화에서 매우 중요한 요소입니다. 이 과정을 이해하고 최적화하는 방법을 적용하면, 더 빠르고 사용자 경험이 뛰어난 웹 페이지를 만들 수 있습니다.
